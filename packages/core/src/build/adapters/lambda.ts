import type { BuildAdapter, BuildGroup, GeneratedFile } from './types.js';

export const lambdaAdapter: BuildAdapter = {
  target: 'aws-lambda',

  generateEntry(_group: BuildGroup, appImportPath: string): string {
    return [
      '// Auto-generated by kagaribi. Do not edit.',
      `import { handle } from 'hono/aws-lambda';`,
      `import app from '${appImportPath}';`,
      '',
      'export const handler = handle(app);',
      '',
    ].join('\n');
  },

  generateConfigs(_group: BuildGroup): GeneratedFile[] {
    return [];
  },

  deployInstructions(group: BuildGroup): string {
    return [
      `Build: dist/${group.host.name}/index.js`,
      `Deploy: cd dist/${group.host.name} && zip index.zip index.js`,
      `        aws lambda update-function-code --function-name ${group.host.name} --zip-file fileb://dist/${group.host.name}/index.zip`,
    ].join('\n  ');
  },
};
