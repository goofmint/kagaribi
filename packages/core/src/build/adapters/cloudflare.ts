import type { BuildAdapter, BuildGroup, GeneratedFile } from './types.js';

export const cloudflareAdapter: BuildAdapter = {
  target: 'cloudflare-workers',

  generateEntry(_group: BuildGroup, appImportPath: string): string {
    return [
      '// Auto-generated by kagaribi. Do not edit.',
      `import app from '${appImportPath}';`,
      '',
      'export default app;',
      '',
    ].join('\n');
  },

  generateConfigs(group: BuildGroup): GeneratedFile[] {
    const COMPATIBILITY_DATE = '2024-12-01';
    return [
      {
        filename: 'wrangler.toml',
        content: [
          `name = "${group.host.name}"`,
          `main = "index.js"`,
          `compatibility_date = "${COMPATIBILITY_DATE}"`,
          '',
        ].join('\n'),
      },
    ];
  },

  deployInstructions(group: BuildGroup): string {
    return [
      `Build: dist/${group.host.name}/index.js`,
      `Deploy: cd dist/${group.host.name} && wrangler deploy`,
    ].join('\n  ');
  },
};
